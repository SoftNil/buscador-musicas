<!DOCTYPE html>
<html lang="pt-br" data-bs-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Upload JSON de Bandas</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body { 
    background: #121212; 
    color: #fff; 
    display: flex; 
    justify-content: center; 
    align-items: center; 
    height: 100vh; 
  }
  .card { width: 100%; max-width: 500px; }
  .form-label { color: #fff; }
  #progressContainer { display: none; margin-top: 10px; }
</style>
</head>
<body>

<div class="card p-4 shadow-lg bg-dark border-success">
  <h3 class="card-title text-center mb-4">Upload JSON de Bandas</h3>

  <form id="uploadForm">
    <div class="mb-3">
      <label for="usuario" class="form-label">Usuário</label>
      <input type="text" class="form-control" id="usuario" name="usuario" placeholder="Digite seu usuário" required>
    </div>

    <div class="mb-3">
      <label for="senha" class="form-label">Senha</label>
      <input type="password" class="form-control" id="senha" name="senha" placeholder="Digite sua senha" required>
    </div>

    <div class="mb-3">
      <label for="jsonFile" class="form-label">Arquivo JSON</label>
      <input class="form-control" type="file" id="jsonFile" name="jsonFile" accept=".json" required>
      <div class="form-text text-white-50">Selecione o arquivo JSON das bandas para importar.</div>
    </div>

    <button type="submit" class="btn btn-success w-100">Enviar JSON</button>
  </form>

  <div id="progressContainer" class="progress mt-3">
    <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
  </div>
</div>

<!-- Toast -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1080;">
  <div id="toast" class="toast align-items-center text-white bg-dark border-success" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body" id="toastBody"></div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
const uploadForm = document.getElementById('uploadForm');
const progressContainer = document.getElementById('progressContainer');
const progressBar = document.getElementById('progressBar');
const toast = new bootstrap.Toast(document.getElementById('toast'));
const toastBody = document.getElementById('toastBody');

uploadForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const usuario = document.getElementById('usuario').value;
    const senha = document.getElementById('senha').value;
    const file = document.getElementById('jsonFile').files[0];

    if (!file) return;

    const formData = new FormData();
    formData.append('usuario', usuario);
    formData.append('senha', senha);
    formData.append('jsonFile', file);

    const xhr = new XMLHttpRequest();
    xhr.open('POST', 'upload.php');

    xhr.upload.addEventListener('loadstart', () => {
        progressContainer.style.display = 'block';
        progressBar.style.width = '0%';
    });

    xhr.upload.addEventListener('progress', (event) => {
        if (event.lengthComputable) {
            const percent = Math.round((event.loaded / event.total) * 100);
            progressBar.style.width = percent + '%';
        }
    });

    xhr.onreadystatechange = () => {
        if (xhr.readyState === XMLHttpRequest.DONE) {
            progressBar.style.width = '100%';
            try {
                const response = JSON.parse(xhr.responseText);
                showToast(response.message || 'Upload concluído com sucesso!');
            } catch {
                showToast(xhr.responseText || 'Erro ao enviar o arquivo!');
            }
            setTimeout(() => { progressContainer.style.display = 'none'; progressBar.style.width = '0%'; }, 2000);
        }
    };

    xhr.send(formData);
});

function showToast(message) {
    toastBody.textContent = message;
    toast.show();
}
</script>

</body>
</html>
